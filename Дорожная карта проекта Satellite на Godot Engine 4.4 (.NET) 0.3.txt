# Дорожная карта проекта Satellite на Godot Engine 4.4 (.NET) — версия 0.3

## 0. О документе
- Назначение: консолидированная дорожная карта на ближайшие 4–6 недель с применением современных практик разработки игр.
- Актуальность: отражает текущее состояние — генерация биомов и полов завершена; генерация стен в процессе.
- Формат: ориентир для планирования спринтов, контроля прогресса, управления рисками и коммуникаций команды.

## 1. Снимок текущего состояния (as-is)
- Движок: Godot Engine 4.4 (.NET/C#), изометрическая проекция 2:1, `TileMapLayer`.
- Ключевые подсистемы:
  - Изометрия, камера и Y-sort: реализовано.
  - Игрок, взаимодействия, базовый UI/инвентарь: реализовано (v0.2).
  - Генерация мира (World Biomes):
    - Биомы: размещение и маска мира — ГОТОВО.
    - Полы: укладка тайлов пола — ГОТОВО.
    - Стены: алгоритм выбора и укладки стен — В ПРОЦЕССЕ.
    - Overlay-слой стен и окклюзия: В ПЛАНЕ в рамках v0.3.
    - Соединение секций/трейлы/реки: базовая логика есть, требуется полировка.
  - Сохранения/загрузки: подсистема реализована, интеграция с прогрессом продолжается.
- Код: `LevelGenerator`, `WorldBiomesGenerator` используют `FloorsTileMap`, `WallsTileMap`, `WallsOverlayTileMap`; параметризация сидов, биомов, коридоров и рек присутствует.

## 2. Цели версии 0.3 (to-be)
Главная цель: довести процедурную генерацию уровня до вертикального среза «играбельная экспедиция» с корректной геометрией и навигацией.

- Завершить генерацию стен с вариативностью, overlay и коллизиями.
- Гарантировать связность проходов между ключевыми областями (залы биомов, локальные коридоры, глобальные «тропы»).
- Ввести базовые правила размещения объектов (ресурсные узлы/контейнеры) с привязкой к биому.
- Обеспечить стабильность, воспроизводимость по сидy и метрики производительности генерации.
- Запустить минимальный цикл «станция → телепорт → рейд → возврат» в одном проходе.

Критерий готовности v0.3: игрок стабильно спавнится в проходимой области, карта связна, стены корректны визуально и по коллизиям, базовые ресурсы/контейнеры генерируются по правилам биомов, FPS ≥ 120 на тестовой конфигурации при размере мира по умолчанию.

## 3. План работ и вехи
Горизонт планирования: 4–6 недель, спринты по 1 неделе, еженедельные демо. Арт-задачи ведутся в Kanban-потоке.

### Веха A: Генерация стен (1–2 недели)
- Автотайлинг стен: правила выбора тайлов по соседям (включая углы/стыки).
- Разделение: `WallsTileMap` (основной силуэт) и `WallsOverlayTileMap` (верхние грани/окклюзия).
- Коллизии: генерация или привязка к тайлам стен; корректная физика.
- Дверные проемы: вырезы в стенах, совместимость с коридорами/зонами перехода.
- Освещение/окклюзия: совместимость с 2D Light/Shadow (при наличии); базовый pass.
- DoD:
  - Воспроизводимость по сидy.
  - 0 «запечатанных» спавнов и «висящих» стен в 1k автопрогонов.
  - Визуальная непрерывность контуров 99%+ согласно автотестам соседства.

### Веха B: Связность и навигация (1 неделя)
- Проверка связности комнат/залов/коридоров (graph connectivity).
- Ручные «мосты» между секциями при необходимости; параметры ширины коннекторов.
- Тест на достижимость контрольных точек из спавна (по клеточной сетке).
- DoD: 100% карт из 1k прогонов имеют путь «spawn → N ключевых узлов». 

### Веха C: Размещение объектов по биомам (1 неделя)
- Таблицы спавна для ресурсов/контейнеров, плотность и раритеты.
- Ограничения: дистанция от стен/проходов, недопустимые зоны.
- Базовые лут-таблицы; интеграция с инвентарем и взаимодействиями.
- DoD: распределение по биомам соответствует конфигу, без коллизий с навигацией.

### Веха D: Станция → Рейд → Возврат (1 неделя)
- Минимально жизнеспособный цикл с `StartingModule` и `TeleportationModule`.
- Сохранение точки возврата, базовые триггеры входа/выхода из рейда.
- DoD: вход/выход из рейда стабилен, сохранения консистентны.

### Веха E: Стабильность, производительность и UX (0.5–1 неделя)
- Профилирование: CPU/GPU, тайминг генерации, память.
- Оптимизации: сокращение аллокаций, батчинг, упрощение правил.
- UX: переключатели отладки (координаты, сетка, сид, слои), горячие клавиши.
- DoD: генерация ≤ 300 мс для дефолтного размера; средний FPS ≥ 120.

## 4. Agile-процесс и артефакты
- Каденс: 1-недельные спринты, демо по пятницам, ретро ежеспринтово.
- Канбан-лента для арта/аудио и RnD-исследований; WIP-лимиты.
- Ceremonies: планирование (2 ч), стендапы (15 мин), демо (30 мин), ретро (45 мин).
- Backlog grooming раз в неделю; приоритизация MoSCoW.
- Definition of Ready (DoR):
  - Описана цель, входы/выходы, зависимости, риски, DoD, оценка.
- Definition of Done (DoD):
  - Работает, покрыто автотестами (юнит/интеграция), профилировано, задокументировано, фича-флаг/настройка, без регрессий, пройден code review.

## 5. Тестирование и качество
- Автотесты генератора:
  - Property-based: связность, доля открытых клеток, отсутствие изолятов, корректность соседства стен.
  - Регрессионные «золотые сиды»: набор фиксированных сидов, сравнение масок/тайл-мапов.
  - 1k soak-тест генерации на CI (headless).
- Интеграционные тесты: спавн игрока на валидной клетке, достижимость целей, отсутствие «мягких» застреваний.
- Визуальные снапшоты (по желанию): рендер тайлмапов в текстуры и сравнение гистограмм.

## 6. CI/CD и инженерные практики
- CI: сборка Godot headless, запуск тестов, публикация артефактов (win/mac/linux) nightly.
- Code quality: статический анализ (Roslyn analyzers), форматирование, обязательный review.
- Версионирование: SemVer, теги релизов, changelog.
- Фича-флаги/настройки: параметры генератора — в экспортируемых свойствах/конфиге.
- Телеметрия (локальная): время генерации, доля открытых клеток, количество комнат/мостов, количество коллизий.

## 7. Производительность и цели
- Метрики v0.3:
  - Время генерации дефолтной карты ≤ 300 мс (release, headless).
  - Оверхед отрисовки стен/оверлея ≤ 10% к полу.
  - Пиковые аллокации < 10 МБ на генерацию.
  - FPS ≥ 120 на тестовой машине при дефолтных размерах и зуме камеры.

## 8. Контент, арт и UX
- Tileset-аудит: индексы и правила автотайлинга, таблица соответствий «соседство → спрайт».
- Overlay-грани стен: консистентные высоты, читаемость на пересечениях.
- Биомная палитра: расширение/унификация, цветовые контрасты пола/стены.
- UI отладки: переключатели слоев, отображение координат, сид, статистики генерации.

## 9. Геймплейные интеграции (в рамках v0.3)
- Двери: места, логика открытия/закрытия, совместимость с коллизиями стен.
- Ресурсные узлы/контейнеры: базовые таблицы по биомам, дистанционные ограничения.
- Триггеры экспедиции: вход/выход, сохранение позиции/прогресса.

## 10. Риски и меры
- Сложность правил стен/автотайлинга → Мера: таблицы соседства, золотые сиды, property-based тесты.
- Производительность/аллокации → Мера: кэширование, предвыделение массивов, профилирование.
- Переразрастание скоупа → Мера: MoSCoW, спринтовые лимиты, «стоп-лист» на новые фичи.
- Изменения Godot 4.4 → Мера: пин версий редактора/экспортных шаблонов, smoke-тесты при апгрейде.

## 11. Обязательства по документации
- Спецификация генератора: входы/выходы, параметры, распределения, детерминизм.
- Каталог тайлов: индексы, спрайты, правила соседства, коллизии.
- Руководство отладки: горячие клавиши, оверлеи, сохранение изображений масок.
- Гайд по сид-тестам и золотым наборам.

## 12. Backlog v0.3 (MoSCoW)
- MUST:
  - Автотайлинг стен с overlay, корректные коллизии.
  - Связность карты и гарантированный путь от спавна к ключевым залам.
  - Базовый спавн ресурсов/контейнеров по биомам.
  - Мини-цикл «станция → рейд → станция».
- SHOULD:
  - Дверные проемы с интеракцией.
  - Переключаемые отладочные оверлеи и сохранение статистики.
  - Простая система лута (таблицы/редкость).
- COULD:
  - Базовые аудио-вставки (шаги, двери).
  - Визуальные снапшоты для регрессионных тестов.
- WON'T (в v0.3):
  - Мультиплеер, продвинутый AI, полноценная боевая система.

## 13. Дорожная карта по спринтам (референс)
- Спринт 1: Автотайлинг стен, базовые коллизии, smoke-тесты связности.
- Спринт 2: Overlay, двери/проемы, проходы между секциями, регрессионные сиды.
- Спринт 3: Спавн ресурсов/контейнеров по биомам, UX-отладка, профилирование и оптимизации.
- Спринт 4: Цикл «станция ↔ рейд», стабилизация, QA, релиз v0.3.

## 14. Критерии приемки релиза 0.3
- 100% автопрогонов на наборе из 50 «золотых» сидов завершены успешно.
- 99% карт на случайных 1k сидов имеют полную связность ключевых узлов.
- Нет известных критических дефектов (P0) и блокеров.
- Документация и таблицы тайлов актуальны, CI сборки зелёные 7 дней подряд.

## 15. Приложение A — заметки для реализации стен
- Матрица соседства 3×3 (Moore) → индекс правила → ID тайла.
- Отдельные правила для:
  - Внутренних углов, внешних углов, Т-стыков, перекрестий, торцевых заглушек.
  - Биом-специфических вариантов спрайтов (вариативность).
- Overlay рисуется только для видимых верхних граней с учётом соседей.
- Коллизии: привязка к маске, а не к спрайту; избегать «тонких» коллизий.

## 16. Изменения относительно v0.2
- Добавлены разделы: Agile/Scrum-процесс, CI/CD, тестирование, риски, KPI.
- Уточнён статус генерации: биомы/полы готовы, стены в активной разработке.
- Включён план по вертикальному срезу «экспедиция» и критериям приемки.


